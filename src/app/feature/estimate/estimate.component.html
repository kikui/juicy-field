<div class="container" style="margin-top: 56px;">
  <button mat-raised-button color="primary" class="my-3 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseParams" aria-expanded="false" aria-controls="collapseParams">
    Paramètres
  </button>
  <div class="row collapse mb-5" id="collapseParams">
    <div class="col-12 mb-3"><span class="primary border-bottom border-secondary pb-1 pe-1">Paramètres d'investissement recurrent</span></div>
    <div class="container-table">
      <table mat-table [dataSource]="investParams.recurrentInvests" class="mat-elevation-z3 my-3 w-100">
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Montant (€)</th>
          <td mat-cell *matCellDef="let element; let i = index">
            <mat-form-field>
              <input matInput type="number" [(ngModel)]="investParams.recurrentInvests[i].amount"/>
            </mat-form-field>
          </td>
        </ng-container>
        <ng-container matColumnDef="frequency">
          <th mat-header-cell *matHeaderCellDef>Fréquence (en mois)</th>
          <td mat-cell *matCellDef="let element; let i = index">
            <mat-form-field>
              <input matInput type="number" [(ngModel)]="investParams.recurrentInvests[i].frequency"/>
            </mat-form-field>
          </td>
        </ng-container>
        <ng-container matColumnDef="startIndex">
          <th mat-header-cell *matHeaderCellDef>Index début de l'occurence</th>
          <td mat-cell *matCellDef="let element; let i = index">
            <mat-form-field>
              <input matInput type="number" [(ngModel)]="investParams.recurrentInvests[i].startIndex"/>
            </mat-form-field>
          </td>
        </ng-container>
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>
            <div class="d-flex justify-content-center align-items-center">
              <div>Action</div>
              <button class="add-button ms-2" (click)="addEntrie(EnumInvestType.recurrentInvest)"><mat-icon>add</mat-icon></button>
            </div>
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            <div class="d-flex w-100">
              <button *ngIf="investParams.recurrentInvests.length > 1" class="m-auto" mat-raised-button color="primary" (click)="deleteEntrie(EnumInvestType.recurrentInvest, i)">Supprimer</button>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="recurrentInvestDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: recurrentInvestDisplayedColumns;"></tr>
      </table>
    </div>

    <div class="col-12 my-3"><span class="primary border-bottom border-secondary pb-1 ps-1">Paramètres d'investissement ponctuel</span></div>
    <div class="container-table">
      <table mat-table [dataSource]="investParams.ponctualInvests" class="mat-elevation-z3 my-3 w-100">
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Montant (€)</th>
          <td mat-cell *matCellDef="let element; let i = index">
            <mat-form-field>
              <input matInput type="number" [(ngModel)]="investParams.ponctualInvests[i].amount"/>
            </mat-form-field>
          </td>
        </ng-container>
    
        <ng-container matColumnDef="index">
          <th mat-header-cell *matHeaderCellDef>Index mois cible</th>
          <td mat-cell *matCellDef="let element; let i = index">
            <mat-form-field>
              <input matInput type="number" [(ngModel)]="investParams.ponctualInvests[i].index"/>
            </mat-form-field>
          </td>
        </ng-container>
    
        <ng-container matColumnDef="indexRefund">
          <th mat-header-cell *matHeaderCellDef>Index mois de remboursement | 0 = pas de remboursement</th>
          <td mat-cell *matCellDef="let element; let i = index">
            <mat-form-field>
              <input matInput type="number" [(ngModel)]="investParams.ponctualInvests[i].indexRefund"/>
            </mat-form-field>
          </td>
        </ng-container>
    
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>
            <div class="d-flex justify-content-center align-items-center">
              <div>Action</div>
              <button class="add-button ms-2" (click)="addEntrie(EnumInvestType.ponctualInvest)"><mat-icon>add</mat-icon></button>
            </div>
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            <div class="d-flex w-100">
              <button *ngIf="investParams.recurrentInvests.length > 1" class="m-auto" mat-raised-button color="primary" (click)="deleteEntrie(EnumInvestType.ponctualInvest, i)">Supprimer</button>
            </div>
          </td>
        </ng-container>
    
        <tr mat-header-row *matHeaderRowDef="ponctualInvestDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: ponctualInvestDisplayedColumns;"></tr>
      </table>
    </div>

<!--     <div class="col-12 my-3"><span class="primary border-bottom border-secondary pb-1 ps-1">Paramètres de réinvestissement</span></div>

    <mat-form-field class="col-6">
      <mat-label>Réinvestissement des gains (%)</mat-label>
      <input matInput type="number" [min]="0" [max]="100" [(ngModel)]="partialReinvest.percent"/>
    </mat-form-field>
    <mat-form-field class="col-6">
      <mat-label>Temps minimal avant le premier retrait (en mois)</mat-label>
      <input matInput type="number" [min]="0" [(ngModel)]="partialReinvest.minimalTimeBeforeDrop"/>
    </mat-form-field>
    <mat-form-field class="col-6">
      <mat-label>Fréquence de retrait (en mois)</mat-label>
      <input matInput type="number" [min]="1" [(ngModel)]="partialReinvest.frequency"/>
    </mat-form-field>
    <mat-form-field class="col-6">
      <mat-label>Plafond max par retrait (€) (0 = pas de plafond)</mat-label>
      <input matInput type="number" [min]="0" [(ngModel)]="partialReinvest.maxRentDrop"/>
    </mat-form-field> -->

    <div class="col-12 my-3"><span class="primary border-bottom border-secondary pb-1 pe-1">Paramètres globeaux</span></div>

    <mat-form-field class="col-6">
      <mat-label>Investissement Type</mat-label>
      <mat-select [(ngModel)]="investParams.investTypeId">
        <mat-option *ngFor="let investType of investTypeData" value="{{investType.id}}">{{investType.name}}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field  class="col-6">
      <mat-label>Rentabité de la plante (€)</mat-label>
      <mat-select [(ngModel)]="investParams.plantRentabity">
        <mat-option *ngFor="let amount of arrayInvestTypeRevenu" value="{{amount}}">{{amount}} € ({{100*amount/currentInvestType.price - 100}}%)</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field  class="col-6">
      <mat-label>Nombre d'années</mat-label>
      <input matInput type="number" [min]="1" [(ngModel)]="investParams.yearsGeneration"/>
    </mat-form-field>

    <div class="col-12 text-center my-3"><span class="primary border-bottom border-secondary pb-1 px-1">Filtres</span></div>

    <mat-checkbox class="col-6 text-center mb-2" [(ngModel)]="displayPanel.totalInvest"><span style="white-space: normal;">Total investi</span></mat-checkbox>
    <mat-checkbox class="col-6 text-center mb-2" [(ngModel)]="displayPanel.totalSelfInvest"><span style="white-space: normal;">Total investi soi meme</span></mat-checkbox>
    <mat-checkbox class="col-6 text-center mb-2" [(ngModel)]="displayPanel.realProfit"><span style="white-space: normal;">Profit réel</span></mat-checkbox>
    <mat-checkbox class="col-6 text-center mb-2" [(ngModel)]="displayPanel.currentRent"><span style="white-space: normal;">Rentrée courante</span></mat-checkbox>
    <mat-checkbox class="col-6 text-center mb-2" [(ngModel)]="displayPanel.currentPlantPaid"><span style="white-space: normal;">Plante payé</span></mat-checkbox>
    <mat-checkbox class="col-6 text-center mb-2" [(ngModel)]="displayPanel.totalPlantInGrowing"><span style="white-space: normal;">Plante total en croissance</span></mat-checkbox>
    <mat-checkbox class="col-6 text-center mb-2" [(ngModel)]="displayPanel.benefit"><span style="white-space: normal;">Bénéfice</span></mat-checkbox>
    <div class="col-12 d-flex align-items-center justify-content-center">
      <button mat-raised-button color="primary" (click)="save()">Recalculer</button>
    </div>
  </div>  
  <div class="d-flex justify-content-center">
    <ngx-charts-line-chart
      [view]="[window().innerWidth, window().innerHeight -56 -21 -32 -48]"
      [autoScale]="true"
      [legendPosition]="legendPosition"
      [legend]="legend"
      [showXAxisLabel]="showXAxisLabel"
      [showYAxisLabel]="showYAxisLabel"
      [xAxis]="xAxis"
      [yAxis]="yAxis"
      [xAxisLabel]="xAxisLabel"
      [yAxisLabel]="yAxisLabel"
      [results]="ngxArrayData">
    </ngx-charts-line-chart>
  </div>
</div>